<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <title>Detalle de Pago</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #dcdde1;
            margin: 0;
            padding: 32px;
        }

        .card {
            max-width: 820px;
            margin: 0 auto;
            background: #e3e4e6;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 22px;
        }

        .title {
            margin: 0 0 6px 0;
            text-align: center;
            font-size: 22px;
            font-weight: 700;
            color: #222
        }

        .sub {
            margin: 0 0 14px 0;
            text-align: center;
            color: #444;
            font-size: 14px
        }

        .check {
            width: 60px;
            height: 60px;
            background: #22c55e;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 34px;
            color: #fff;
            margin: 8px auto 10px auto
        }

        .grid {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 10px 16px;
            align-items: center
        }

        .label {
            color: #222;
            font-weight: 600
        }

        .pill {
            background: #eef2f7;
            border-radius: 18px;
            padding: 8px 14px;
            display: inline-block;
            min-height: 20px;
            white-space: pre-line
        }

        .actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 16px
        }

        .btn {
            border: none;
            border-radius: 22px;
            padding: 10px 18px;
            font-weight: 600;
            cursor: pointer
        }

        .btn.secondary {
            background: #6b7280;
            color: #fff;
            text-decoration: none
        }

        .btn.share {
            background: #10b981;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .hint {
            margin-top: 14px;
            color: #6b7280;
            font-size: 12px
        }

        .badge-state {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 18px;
            color: #fff;
            font-weight: 700;
            font-size: 12px
        }

        .st-completado {
            background: #22c55e
        }

        .st-pendiente {
            background: #3f3d56
        }

        .st-vencido {
            background: #9ca3af
        }

        .st-sobrante {
            background: #f59e0b
        }

        .st-faltante {
            background: #ef4444
        }

        .copy {
            border: none;
            background: none;
            color: #d63031;
            font-size: 18px;
            cursor: pointer;
            margin-left: 8px
        }

        .copy:hover {
            color: #ff6b6b
        }
    </style>
</head>

<body>
    <div class="card" id="card">
        <h2 class="title">Pago Confirmado</h2>
        <div class="sub" id="sub">ID Orden: â€”</div>
        <div class="check">âœ“</div>

        <div class="grid">
            <div class="label">Estado de cobro</div>
            <div id="estado"><span class="badge-state st-pendiente">pendiente</span></div>

            <div class="label">Datos de tu pago</div>
            <div></div>

            <div class="label">Monto</div>
            <div class="pill" id="monto">$â€”</div>

            <div class="label">Referencia del pago</div>
            <div class="pill" id="desc">â€”</div>

            <div class="label">Cuenta Origen</div>
            <div>
                <span class="pill" id="cuenta">â€”</span>

            </div>

            <div class="label">Fecha</div>
            <div class="pill" id="fecha">â€”</div>

            <div class="label">Hora</div>
            <div class="pill" id="hora">â€”</div>

            <div class="label">ID coelsa</div>
            <div>
                <span class="pill" id="coelsa">â€”</span>

            </div>

            <div class="label">Alias / CVU</div>
            <div>
                <span class="pill" id="aliascvu">â€”</span>

            </div>
        </div>

        <div class="actions">
            <button class="btn share" id="shareBtn">Compartir</button>
            <a class="btn secondary" href="/index.html">Volver</a>
        </div>
    </div>

    <script>
        const q = new URLSearchParams(location.search);
        const order = q.get('order');

        if (!order) {
            document.getElementById('card').innerHTML = '<p>Falta el parÃ¡metro <b>order</b></p>';
        } else {
            fetch(`/api/payments/${order}`)
                .then(r => r.json())
                .then(p => {
                    if (!p || p.error) {
                        document.getElementById('card').innerHTML = '<p>Pago no encontrado</p>';
                        return;
                    }

                    // Estado
                    const estado = p.status || 'pendiente';
                    const estadoMap = {
                        completado: 'st-completado',
                        pendiente: 'st-pendiente',
                        vencido: 'st-vencido',
                        sobrante: 'st-sobrante',
                        faltante: 'st-faltante'
                    };
                    document.getElementById('estado').innerHTML =
                        `<span class="badge-state ${estadoMap[estado] || 'st-pendiente'}">${estado}</span>`;

                    // Encabezado y bÃ¡sicos
                    document.getElementById('sub').textContent = `ID Orden: ${p.orderId}`;
                    document.getElementById('monto').textContent = `$${p.amount}`;
                    document.getElementById('desc').textContent = p.description || 'â€”';

                    // Cuenta/alias/cvu (si llegan en paymentInfo)
                    const titular = p.paymentInfo?.titular || '';
                    const cuit = p.paymentInfo?.cuit || '';
                    const cvu = p.paymentInfo?.cvu || '';
                    const alias = p.paymentInfo?.alias || '';
                    const cuentaTxt = [cvu, cuit ? `CUIT ${cuit}` : '', titular].filter(Boolean).join('\n');
                    document.getElementById('cuenta').textContent = cuentaTxt;
                    document.getElementById('aliascvu').textContent = [alias, cvu].filter(Boolean).join(' Â· ');

                    // Fecha / Hora (usamos createdAt/updatedAt)
                    const ts = p.updatedAt || p.createdAt || new Date().toISOString();
                    const d = new Date(ts);
                    document.getElementById('fecha').textContent = d.toLocaleDateString();
                    document.getElementById('hora').textContent = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    // ID Coelsa (si existe)
                    document.getElementById('coelsa').textContent = p.paymentInfo?.coelsaId || 'â€”';

                    // Copiar
                    document.querySelectorAll('.copy').forEach(btn => {
                        btn.onclick = () => {
                            const val = document.getElementById(btn.dataset.target).textContent.trim();
                            navigator.clipboard.writeText(val);
                            btn.textContent = 'âœ…';
                            setTimeout(() => btn.textContent = 'ðŸ“‹', 1200);
                        };
                    });

                    // Compartir por WhatsApp
                    document.getElementById('shareBtn').onclick = () => {
                        const msg = `Pago confirmado
                        ID Orden: ${p.orderId}
                        Monto: $${p.amount}
                        Ref: ${p.description || '-'}
                        Estado: ${estado}`;
                        const wurl = `https://wa.me/?text=${encodeURIComponent(msg)}`;
                        window.open(wurl, '_blank');
                    };
                })
                .catch(() => {
                    document.getElementById('card').innerHTML = '<p>Error cargando el pago</p>';
                });
        }
    </script>
</body>

</html>